# Use official Ollama image as base
FROM ollama/ollama:latest

# Set environment variables
ENV OLLAMA_HOST=0.0.0.0

# Create a user to run the application (security best practice for HF)
RUN useradd -m -u 1000 user
USER user
ENV HOME=/home/user \
	PATH=/home/user/.local/bin:$PATH

WORKDIR $HOME/app

# Expose port (HF Spaces defaults to 7860, but Ollama uses 11434)
# We might need a script to run ollama serve and maybe a proxy if HF strictly needs 7860
# But usually we can map it. For simplicity, let's keep it simple first.
EXPOSE 7860

# Install curl for healthcheck/pulling
USER root
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

# Copy a startup script
COPY --chown=user start.sh /start.sh
RUN chmod +x /start.sh

USER user

CMD ["/start.sh"]
